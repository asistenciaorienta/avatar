<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Live2D funcionando</title>
  <style>
    body { margin: 0; background-color: #f0f; overflow: hidden; }
    canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; }
  </style>
</head>
<body>

  <script>   //muestra ventana con la versi√≥n.
    window.onload = function() {
      alert("Versi√≥n 1.3");
    };
  </script>

  <!-- PIXI.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/5.3.12/pixi.min.js"></script>
  <!-- Live2D Cubism Core -->
  <script src="libs/Core/live2dcubismcore.min.js"></script>
  <!-- pixi-live2d-display con soporte Cubism 4 -->
  <script src="https://cdn.jsdelivr.net/npm/pixi-live2d-display@0.4.0/dist/cubism4.min.js"></script>

  <script> 
    const app = new PIXI.Application({
      view: document.createElement("canvas"),
      autoStart: true,
      resizeTo: window,
      backgroundAlpha: 0
    });
    document.body.appendChild(app.view);

    // Ruta de modelo y animaci√≥n
    const modelPath = "modelo290825_2/modelo290825_2.model3.json";

    //variables para simular que parpadea
    let nextBlink = Date.now() + (2000 + Math.random() * 3000); // primer parpadeo entre 2 y 5s
    let blinking = false;

    // üîπ Variables para simular el habla
    let talking = false;
    let mouthValue = 0;
    let mouthSpeed = 0.92; // velocidad apertura/cierre
    
    // Cargar modelo
    PIXI.live2d.Live2DModel.from(modelPath).then(model => {
      model.scale.set(0.25);
      model.x = (window.innerWidth - model.width * model.scale.x) / 2;
      model.y = (window.innerHeight - model.height * model.scale.y) / 2;
      app.stage.addChild(model);
      model.internalModel.coreModel.setParameterValueById("ParametroParpadeo", 0); //inicio con ojos abiertos
      model.internalModel.coreModel.setParameterValueById("ParametroAtencion", -30.0); //inicio con ojos y cejas normales
      model.internalModel.coreModel.setParameterValueById("Parametromoverpierna", -30.0); //inicio con pierna natural
      model.internalModel.coreModel.setParameterValueById("ParametroMouthOpen", 0.0); //inicio con boca cerrada
      model.internalModel.coreModel.setParameterValueById("ParametroMouthSpeak", -1.0); //inicio no habla
      
      // üëâ Evento: hacer clic para que empiece/parar de hablar
      model.interactive = true;
      model.buttonMode = true;
      model.on("pointerdown", () => {
        talking = !talking; // alterna hablar/no hablar      
      });   
      
      // üëÄ Forzar par√°metros en cada frame
      app.ticker.add(() => {
        //parpadeo
        const now = Date.now();      
        if (!blinking && now >= nextBlink) {
          // Inicia parpadeo
          blinking = true;
          nextBlink = now + 100; // cerrar ojos durante 0.1s
          model.internalModel.coreModel.setParameterValueById("ParametroParpadeo", 1);
        } else if (blinking && now >= nextBlink) {
          // Termina parpadeo
          blinking = false;
          nextBlink = now + (2000 + Math.random() * 3000); // pr√≥ximo parpadeo entre 2 y 5s
          model.internalModel.coreModel.setParameterValueById("ParametroParpadeo", 0);
        }      

        //hablar
        if (talking) {
          // activa par√°metro "hablando"
          model.internalModel.coreModel.setParameterValueById("ParametroMouthOpen", 1.0);
          model.internalModel.coreModel.setParameterValueById("ParametroMouthSpeak", 1.0);
  
          // animaci√≥n apertura/cierre de boca
          mouthValue += mouthSpeed;
          if (mouthValue >= 1 || mouthValue <= 0) {
            mouthSpeed *= -1; // invierte movimiento
          }
          model.internalModel.coreModel.setParameterValueById("ParametroMouthSpeak", mouthValue);
        } else {
          // si no habla ‚Üí boca cerrada
          model.internalModel.coreModel.setParameterValueById("ParametroMouthSpeak", -1.0);
          model.internalModel.coreModel.setParameterValueById("ParametroMouthOpen", 0.0);
        }        
      });
    }).catch(err => console.error("Error cargando modelo:", err));
  </script>
</body>
</html>














